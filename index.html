<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üéÇ Alles Gute zum Geburtstag, Amelie!</title>
    <meta name="description" content="Alles Gute zum Geburtstag, Amelie! üéâ">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&family=Pacifico&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            touch-action: manipulation;
        }

        body {
            min-height: 100dvh;
            background: #0a0015;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: 'Outfit', sans-serif;
            color: #fff;
            text-align: center;
            position: relative;
            -webkit-user-select: none;
            user-select: none;
        }

        /* ===== ANIMATED BACKGROUND ===== */
        .bg-layer {
            position: fixed;
            inset: 0;
            z-index: 0;
            background:
                radial-gradient(ellipse at 20% 50%, rgba(168, 85, 247, 0.4) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(236, 72, 153, 0.5) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 100%, rgba(59, 130, 246, 0.3) 0%, transparent 50%),
                radial-gradient(ellipse at 90% 80%, rgba(251, 191, 36, 0.2) 0%, transparent 40%);
            animation: bgRotate 12s ease-in-out infinite alternate;
        }

        @keyframes bgRotate {
            0% {
                filter: hue-rotate(0deg) brightness(0.8);
            }

            50% {
                filter: hue-rotate(30deg) brightness(1.2);
            }

            100% {
                filter: hue-rotate(-20deg) brightness(1);
            }
        }

        /* ===== ALL CANVASES ===== */
        #gameCanvas,
        #fireworksCanvas,
        #confettiCanvas,
        #sparkleCanvas {
            position: fixed;
            inset: 0;
            pointer-events: none;
        }

        #gameCanvas {
            z-index: 5;
            pointer-events: auto;
        }

        #fireworksCanvas {
            z-index: 1;
        }

        #confettiCanvas {
            z-index: 1;
        }

        #sparkleCanvas {
            z-index: 3;
        }

        /* ===== GAME UI OVERLAY ===== */
        .game-ui {
            position: fixed;
            inset: 0;
            z-index: 6;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem 1rem;
            transition: opacity 0.8s ease;
        }

        .game-ui.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .game-title {
            font-family: 'Pacifico', cursive;
            font-size: clamp(1.6rem, 5vw, 2.8rem);
            background: linear-gradient(135deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: rainbowShift 3s ease-in-out infinite;
            text-shadow: none;
            margin-bottom: 0.3rem;
        }

        .game-subtitle {
            font-size: clamp(0.85rem, 2.5vw, 1.1rem);
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 0.5rem;
        }

        .score-bar {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 2rem;
            padding: 0.6rem 1.5rem;
            font-size: clamp(1rem, 3vw, 1.3rem);
            font-weight: 700;
        }

        .score-bar .progress-wrap {
            width: clamp(120px, 30vw, 200px);
            height: 12px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 6px;
            overflow: hidden;
        }

        .score-bar .progress-fill {
            height: 100%;
            border-radius: 6px;
            background: linear-gradient(90deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);
            background-size: 300% 100%;
            animation: rainbowShift 2s ease-in-out infinite;
            transition: width 0.3s ease;
            width: 0%;
        }

        .score-label {
            white-space: nowrap;
        }

        /* Combo text floating up */
        .combo-text {
            position: fixed;
            z-index: 7;
            font-family: 'Outfit', sans-serif;
            font-weight: 900;
            font-size: 2rem;
            pointer-events: none;
            animation: comboFloat 0.8s ease-out forwards;
            text-shadow: 0 0 10px currentColor;
        }

        @keyframes comboFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }

            100% {
                opacity: 0;
                transform: translateY(-80px) scale(1.5);
            }
        }

        /* ===== INTRO SCREEN ===== */
        .intro-screen {
            position: fixed;
            inset: 0;
            z-index: 10;
            background: linear-gradient(135deg, #0a0015 0%, #1a0533 30%, #2d1b69 60%, #1a0533 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 1.5rem;
            cursor: pointer;
            transition: opacity 0.8s ease, visibility 0.8s ease, transform 0.8s ease;
        }

        .intro-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transform: scale(1.15);
        }

        .intro-balloon-row {
            font-size: clamp(3rem, 10vw, 5rem);
            display: flex;
            gap: 0.5rem;
        }

        .intro-balloon-row span {
            animation: introBounce 1.2s ease-in-out infinite;
            display: inline-block;
        }

        .intro-balloon-row span:nth-child(2) {
            animation-delay: 0.15s;
        }

        .intro-balloon-row span:nth-child(3) {
            animation-delay: 0.3s;
        }

        .intro-balloon-row span:nth-child(4) {
            animation-delay: 0.45s;
        }

        .intro-balloon-row span:nth-child(5) {
            animation-delay: 0.6s;
        }

        @keyframes introBounce {

            0%,
            100% {
                transform: translateY(0) scale(1);
            }

            50% {
                transform: translateY(-15px) scale(1.1);
            }
        }

        .intro-title {
            font-family: 'Pacifico', cursive;
            font-size: clamp(2rem, 7vw, 3.5rem);
            background: linear-gradient(135deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: rainbowShift 3s ease-in-out infinite;
        }

        .intro-desc {
            font-size: clamp(0.95rem, 3vw, 1.2rem);
            color: rgba(255, 255, 255, 0.8);
            max-width: 350px;
            line-height: 1.5;
        }

        .intro-start-btn {
            font-family: 'Outfit', sans-serif;
            font-size: clamp(1.1rem, 3.5vw, 1.4rem);
            font-weight: 700;
            color: #fff;
            border: none;
            background: linear-gradient(135deg, #ec4899, #8b5cf6);
            padding: 0.9rem 2.5rem;
            border-radius: 3rem;
            cursor: pointer;
            pointer-events: auto;
            box-shadow: 0 0 30px rgba(236, 72, 153, 0.5), 0 0 60px rgba(139, 92, 246, 0.3);
            animation: btnPulse 2s ease-in-out infinite;
            transition: transform 0.2s;
        }

        .intro-start-btn:hover {
            transform: scale(1.08);
        }

        .intro-start-btn:active {
            transform: scale(0.95);
        }

        @keyframes btnPulse {

            0%,
            100% {
                box-shadow: 0 0 30px rgba(236, 72, 153, 0.5), 0 0 60px rgba(139, 92, 246, 0.3);
            }

            50% {
                box-shadow: 0 0 50px rgba(236, 72, 153, 0.8), 0 0 100px rgba(139, 92, 246, 0.5);
            }
        }

        .intro-screen::before {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            border: 2px solid rgba(167, 139, 250, 0.3);
            animation: ringPulse 3s ease-in-out infinite;
        }

        @keyframes ringPulse {

            0%,
            100% {
                transform: scale(0.8);
                opacity: 0;
            }

            50% {
                transform: scale(1.5);
                opacity: 0.5;
            }
        }

        /* ===== CELEBRATION / BIRTHDAY SHOW ===== */
        .light-rays {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 200vmax;
            height: 200vmax;
            transform: translate(-50%, -50%);
            z-index: 0;
            pointer-events: none;
            background: conic-gradient(from 0deg,
                    transparent 0deg, rgba(251, 191, 36, 0.03) 10deg, transparent 20deg,
                    transparent 30deg, rgba(244, 114, 182, 0.03) 40deg, transparent 50deg,
                    transparent 60deg, rgba(167, 139, 250, 0.03) 70deg, transparent 80deg,
                    transparent 90deg, rgba(96, 165, 250, 0.03) 100deg, transparent 110deg,
                    transparent 120deg, rgba(52, 211, 153, 0.03) 130deg, transparent 140deg,
                    transparent 150deg, rgba(251, 191, 36, 0.03) 160deg, transparent 170deg,
                    transparent 180deg, rgba(244, 114, 182, 0.03) 190deg, transparent 200deg,
                    transparent 210deg, rgba(167, 139, 250, 0.03) 220deg, transparent 230deg,
                    transparent 240deg, rgba(96, 165, 250, 0.03) 250deg, transparent 260deg,
                    transparent 270deg, rgba(52, 211, 153, 0.03) 280deg, transparent 290deg,
                    transparent 300deg, rgba(251, 191, 36, 0.03) 310deg, transparent 320deg,
                    transparent 330deg, rgba(244, 114, 182, 0.03) 340deg, transparent 360deg);
            animation: raysSpin 20s linear infinite;
            opacity: 0;
            transition: opacity 2s ease;
        }

        .light-rays.active {
            opacity: 1;
        }

        @keyframes raysSpin {
            to {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        .balloon-container {
            position: fixed;
            inset: 0;
            z-index: 1;
            pointer-events: none;
            overflow: hidden;
        }

        .float-balloon {
            position: absolute;
            bottom: -80px;
            animation: balloonFloat linear infinite;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }

        @keyframes balloonFloat {
            0% {
                transform: translateY(0) rotate(0deg) scale(1);
                opacity: 0.9;
            }

            25% {
                transform: translateY(-25vh) rotate(10deg) scale(1.05);
            }

            50% {
                transform: translateY(-50vh) rotate(-8deg) scale(1.1);
            }

            75% {
                transform: translateY(-75vh) rotate(5deg) scale(1.05);
            }

            100% {
                transform: translateY(-120vh) rotate(-3deg) scale(1);
                opacity: 0;
            }
        }

        .content {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.8rem;
            max-width: 95vw;
            width: 100%;
            padding: 1rem;
            opacity: 0;
            transition: opacity 0.8s ease;
        }

        .content.visible {
            opacity: 1;
        }

        .cake-wrapper {
            perspective: 800px;
            animation: fadeInBounce 1s ease-out 0.2s both;
        }

        .cake-emoji {
            font-size: clamp(5rem, 18vw, 9rem);
            display: block;
            animation: cake3D 4s ease-in-out infinite;
            filter: drop-shadow(0 0 40px rgba(251, 191, 36, 0.6)) drop-shadow(0 0 80px rgba(236, 72, 153, 0.3));
        }

        @keyframes cake3D {

            0%,
            100% {
                transform: rotateY(0deg) scale(1);
            }

            25% {
                transform: rotateY(15deg) scale(1.05);
            }

            50% {
                transform: rotateY(0deg) scale(1.1);
            }

            75% {
                transform: rotateY(-15deg) scale(1.05);
            }
        }

        .greeting {
            font-family: 'Outfit', sans-serif;
            font-size: clamp(1.1rem, 4vw, 1.6rem);
            font-weight: 700;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: #fff;
            text-shadow: 0 0 10px rgba(167, 139, 250, 0.8), 0 0 30px rgba(167, 139, 250, 0.5), 0 0 60px rgba(167, 139, 250, 0.3);
            animation: fadeInBounce 1s ease-out 0.5s both, neonPulse 3s ease-in-out infinite;
        }

        @keyframes neonPulse {

            0%,
            100% {
                text-shadow: 0 0 10px rgba(167, 139, 250, 0.8), 0 0 30px rgba(167, 139, 250, 0.5), 0 0 60px rgba(167, 139, 250, 0.3);
            }

            50% {
                text-shadow: 0 0 20px rgba(236, 72, 153, 1), 0 0 50px rgba(236, 72, 153, 0.7), 0 0 100px rgba(236, 72, 153, 0.4), 0 0 150px rgba(236, 72, 153, 0.2);
            }
        }

        .name-wrapper {
            position: relative;
            animation: fadeInBounce 1s ease-out 0.8s both;
        }

        .name {
            font-family: 'Pacifico', cursive;
            font-size: clamp(4rem, 18vw, 10rem);
            font-weight: 700;
            background: linear-gradient(135deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3, #54a0ff, #5f27cd, #ff6b6b);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: rainbowShift 3s ease-in-out infinite;
            filter: drop-shadow(0 0 30px rgba(255, 107, 107, 0.5));
            line-height: 1.2;
            position: relative;
        }

        @keyframes rainbowShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .name-glitch {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            font-family: 'Pacifico', cursive;
            font-size: clamp(4rem, 18vw, 10rem);
            font-weight: 700;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            -webkit-background-clip: text;
            line-height: 1.2;
            pointer-events: none;
        }

        .name-glitch.g1 {
            background: linear-gradient(135deg, #ff6b6b, #feca57, #48dbfb);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            animation: rainbowShift 3s ease-in-out infinite, glitch1 4s ease-in-out infinite;
        }

        .name-glitch.g2 {
            background: linear-gradient(135deg, #48dbfb, #ff9ff3, #54a0ff);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            animation: rainbowShift 3s ease-in-out 0.5s infinite, glitch2 4s ease-in-out 0.3s infinite;
        }

        @keyframes glitch1 {

            0%,
            90%,
            100% {
                clip-path: inset(0);
                transform: translate(0);
                opacity: 0;
            }

            92% {
                clip-path: inset(20% 0 60% 0);
                transform: translate(-4px, 2px);
                opacity: 0.7;
            }

            94% {
                clip-path: inset(50% 0 20% 0);
                transform: translate(3px, -1px);
                opacity: 0.7;
            }

            96% {
                clip-path: inset(10% 0 70% 0);
                transform: translate(-2px, 3px);
                opacity: 0.7;
            }
        }

        @keyframes glitch2 {

            0%,
            88%,
            100% {
                clip-path: inset(0);
                transform: translate(0);
                opacity: 0;
            }

            90% {
                clip-path: inset(60% 0 10% 0);
                transform: translate(4px, -2px);
                opacity: 0.5;
            }

            93% {
                clip-path: inset(30% 0 40% 0);
                transform: translate(-3px, 1px);
                opacity: 0.5;
            }

            95% {
                clip-path: inset(70% 0 5% 0);
                transform: translate(2px, -3px);
                opacity: 0.5;
            }
        }

        .subtitle {
            font-size: clamp(0.95rem, 3vw, 1.3rem);
            font-weight: 400;
            color: rgba(255, 255, 255, 0.85);
            animation: fadeInBounce 1s ease-out 1.1s both;
            text-shadow: 0 0 15px rgba(167, 139, 250, 0.3);
        }

        .emoji-row {
            display: flex;
            gap: 0.6rem;
            flex-wrap: wrap;
            justify-content: center;
            font-size: clamp(2rem, 6vw, 3.5rem);
            animation: fadeInBounce 1s ease-out 1.4s both;
        }

        .emoji-row span {
            display: inline-block;
            animation: emojiDance 2s ease-in-out infinite;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .emoji-row span:hover {
            transform: scale(1.5) rotate(20deg) !important;
        }

        .emoji-row span:nth-child(1) {
            animation-delay: 0s;
        }

        .emoji-row span:nth-child(2) {
            animation-delay: 0.15s;
        }

        .emoji-row span:nth-child(3) {
            animation-delay: 0.3s;
        }

        .emoji-row span:nth-child(4) {
            animation-delay: 0.45s;
        }

        .emoji-row span:nth-child(5) {
            animation-delay: 0.6s;
        }

        .emoji-row span:nth-child(6) {
            animation-delay: 0.75s;
        }

        .emoji-row span:nth-child(7) {
            animation-delay: 0.9s;
        }

        .emoji-row span:nth-child(8) {
            animation-delay: 1.05s;
        }

        .emoji-row span:nth-child(9) {
            animation-delay: 1.2s;
        }

        @keyframes emojiDance {

            0%,
            100% {
                transform: translateY(0) rotate(0deg) scale(1);
            }

            25% {
                transform: translateY(-12px) rotate(-15deg) scale(1.15);
            }

            50% {
                transform: translateY(0) rotate(0deg) scale(1);
            }

            75% {
                transform: translateY(-8px) rotate(10deg) scale(1.1);
            }
        }

        @keyframes fadeInBounce {
            0% {
                opacity: 0;
                transform: translateY(50px) scale(0.5);
            }

            60% {
                opacity: 1;
                transform: translateY(-10px) scale(1.05);
            }

            80% {
                transform: translateY(5px) scale(0.98);
            }

            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Controls */
        .sound-toggle,
        .replay-btn {
            position: fixed;
            z-index: 10;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.4rem;
            color: #fff;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(167, 139, 250, 0.3);
        }

        .sound-toggle {
            bottom: 1.5rem;
            right: 1.5rem;
        }

        .replay-btn {
            bottom: 1.5rem;
            left: 1.5rem;
            opacity: 0;
            pointer-events: none;
        }

        .replay-btn.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .sound-toggle:hover,
        .replay-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.15);
        }

        .screen-flash {
            position: fixed;
            inset: 0;
            z-index: 99;
            background: white;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.15s ease;
        }

        .screen-flash.flash {
            opacity: 0.8;
        }

        @media (max-width: 480px) {
            .content {
                gap: 0.6rem;
            }

            .emoji-row {
                gap: 0.3rem;
            }
        }

        @media (max-width: 360px) {
            .name {
                font-size: clamp(3rem, 16vw, 5rem);
            }

            .cake-emoji {
                font-size: clamp(4rem, 16vw, 6rem);
            }
        }
    </style>
</head>

<body>
    <!-- ===== INTRO SCREEN ===== -->
    <div class="intro-screen" id="introScreen">
        <div class="intro-balloon-row">
            <span>üéà</span><span>ü©∑</span><span>üéà</span><span>üíú</span><span>üéà</span>
        </div>
        <div class="intro-title">Balloon Pop!</div>
        <p class="intro-desc">Platze 20 Ballons um deine √úberraschung zu √∂ffnen! üéÅ</p>
        <button class="intro-start-btn" id="startGameBtn">Los geht's! üéâ</button>
    </div>

    <div class="screen-flash" id="screenFlash"></div>
    <div class="bg-layer"></div>
    <div class="light-rays" id="lightRays"></div>

    <!-- Game canvas (on top, interactive) -->
    <canvas id="gameCanvas"></canvas>

    <!-- Show canvases (behind) -->
    <canvas id="fireworksCanvas"></canvas>
    <canvas id="confettiCanvas"></canvas>
    <canvas id="sparkleCanvas"></canvas>

    <!-- Game UI -->
    <div class="game-ui" id="gameUI" class="hidden" style="opacity:0;">
        <div class="game-title">üéà Balloon Pop!</div>
        <div class="game-subtitle">Tippe die Ballons!</div>
        <div class="score-bar">
            <span class="score-label" id="scoreLabel">0 / 20</span>
            <div class="progress-wrap">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>
    </div>

    <!-- Balloon container for celebration -->
    <div class="balloon-container" id="balloonContainer"></div>

    <!-- Birthday content -->
    <div class="content" id="mainContent">
        <div class="cake-wrapper">
            <div class="cake-emoji">üéÇ</div>
        </div>
        <p class="greeting">Alles Gute zum Geburtstag</p>
        <div class="name-wrapper">
            <h1 class="name">Amelie</h1>
            <div class="name-glitch g1" aria-hidden="true">Amelie</div>
            <div class="name-glitch g2" aria-hidden="true">Amelie</div>
        </div>
        <p class="subtitle">Feier sch√∂n und genie√ü deinen besonderen Tag! ü•≥</p>
        <div class="emoji-row">
            <span>üéà</span><span>üéâ</span><span>‚≠ê</span><span>üéä</span><span>üç∞</span>
            <span>üéä</span><span>‚≠ê</span><span>üéâ</span><span>üéà</span>
        </div>
    </div>

    <button class="sound-toggle" id="soundToggle" title="Sound an/aus">üîä</button>
    <button class="replay-btn" id="replayBtn" title="Nochmal abspielen">üîÑ</button>

    <script>
        // ============================================
        // GLOBALS
        // ============================================
        const GOAL = 20;
        const palette = ['#ff6b6b', '#feca57', '#48dbfb', '#ff9ff3', '#54a0ff', '#5f27cd', '#01a3a4', '#f368e0', '#ff6348', '#7bed9f', '#70a1ff', '#ffa502', '#ff4757', '#2ed573', '#eccc68'];
        const pick = a => a[Math.floor(Math.random() * a.length)];
        let soundEnabled = true;
        let audioCtx = null;

        function initAudio() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }

        // ============================================
        // GAME CANVAS
        // ============================================
        const gCanvas = document.getElementById('gameCanvas');
        const gCtx = gCanvas.getContext('2d');
        const fwCanvas = document.getElementById('fireworksCanvas');
        const fwCtx = fwCanvas.getContext('2d');
        const cfCanvas = document.getElementById('confettiCanvas');
        const cfCtx = cfCanvas.getContext('2d');
        const spCanvas = document.getElementById('sparkleCanvas');
        const spCtx = spCanvas.getContext('2d');

        function resizeAll() {
            [gCanvas, fwCanvas, cfCanvas, spCanvas].forEach(c => { c.width = window.innerWidth; c.height = window.innerHeight; });
        }
        resizeAll();
        window.addEventListener('resize', resizeAll);

        // ============================================
        // BALLOON POP GAME
        // ============================================
        let balloons = [];
        let popParticles = [];
        let score = 0;
        let gameRunning = false;
        let gameWon = false;
        let combo = 0;
        let lastPopTime = 0;
        let spawnTimer = 0;
        let difficulty = 1;

        const balloonColors = [
            { body: '#ff6b6b', shine: '#ff9a9a', shadow: '#cc4444' },
            { body: '#feca57', shine: '#ffde85', shadow: '#c99a22' },
            { body: '#48dbfb', shine: '#7ae8ff', shadow: '#1ab0d4' },
            { body: '#ff9ff3', shine: '#ffcaf8', shadow: '#cc6bc0' },
            { body: '#54a0ff', shine: '#85bbff', shadow: '#2270cc' },
            { body: '#5f27cd', shine: '#8a5ce0', shadow: '#3d1a85' },
            { body: '#01a3a4', shine: '#33c9ca', shadow: '#017374' },
            { body: '#f368e0', shine: '#f89aeb', shadow: '#c040ad' },
            { body: '#2ed573', shine: '#62e99a', shadow: '#1aa050' },
            { body: '#ffa502', shine: '#ffc04d', shadow: '#cc8400' },
        ];

        class Balloon {
            constructor() {
                const w = gCanvas.width;
                const h = gCanvas.height;
                this.radius = 28 + Math.random() * 18;
                this.x = this.radius + Math.random() * (w - this.radius * 2);
                this.y = h + this.radius * 2 + Math.random() * 100;
                this.vy = -(1.2 + Math.random() * 1.5 + difficulty * 0.15);
                this.vx = (Math.random() - 0.5) * 0.8;
                this.wobble = Math.random() * Math.PI * 2;
                this.wobbleSpeed = 0.02 + Math.random() * 0.02;
                this.wobbleAmp = 0.5 + Math.random() * 0.8;
                this.color = pick(balloonColors);
                this.alive = true;
                this.rotation = (Math.random() - 0.5) * 0.3;
                this.scale = 0;
                this.targetScale = 1;
            }

            update() {
                this.scale += (this.targetScale - this.scale) * 0.1;
                this.y += this.vy;
                this.x += this.vx + Math.sin(this.wobble) * this.wobbleAmp;
                this.wobble += this.wobbleSpeed;

                // Bounce off walls
                if (this.x - this.radius < 0) { this.x = this.radius; this.vx = Math.abs(this.vx); }
                if (this.x + this.radius > gCanvas.width) { this.x = gCanvas.width - this.radius; this.vx = -Math.abs(this.vx); }

                if (this.y < -this.radius * 3) this.alive = false;
            }

            draw() {
                const r = this.radius * this.scale;
                if (r < 1) return;
                gCtx.save();
                gCtx.translate(this.x, this.y);
                gCtx.rotate(this.rotation);

                // Balloon body (oval)
                gCtx.beginPath();
                gCtx.ellipse(0, 0, r * 0.85, r, 0, 0, Math.PI * 2);
                const grad = gCtx.createRadialGradient(-r * 0.25, -r * 0.3, r * 0.1, 0, 0, r);
                grad.addColorStop(0, this.color.shine);
                grad.addColorStop(0.6, this.color.body);
                grad.addColorStop(1, this.color.shadow);
                gCtx.fillStyle = grad;
                gCtx.fill();

                // Shine highlight
                gCtx.beginPath();
                gCtx.ellipse(-r * 0.25, -r * 0.35, r * 0.2, r * 0.3, -0.3, 0, Math.PI * 2);
                gCtx.fillStyle = 'rgba(255,255,255,0.35)';
                gCtx.fill();

                // Knot at bottom
                gCtx.beginPath();
                gCtx.moveTo(-4, r - 2);
                gCtx.lineTo(0, r + 6);
                gCtx.lineTo(4, r - 2);
                gCtx.fillStyle = this.color.shadow;
                gCtx.fill();

                // String
                gCtx.beginPath();
                gCtx.moveTo(0, r + 6);
                gCtx.quadraticCurveTo(5, r + 25, -3, r + 45);
                gCtx.strokeStyle = 'rgba(255,255,255,0.4)';
                gCtx.lineWidth = 1;
                gCtx.stroke();

                gCtx.restore();
            }

            contains(px, py) {
                const dx = px - this.x;
                const dy = py - this.y;
                const r = this.radius * this.scale;
                return (dx * dx) / (r * 0.85 * r * 0.85) + (dy * dy) / (r * r) <= 1.2;
            }
        }

        class PopParticle {
            constructor(x, y, color) {
                this.x = x; this.y = y;
                const angle = Math.random() * Math.PI * 2;
                const speed = 2 + Math.random() * 6;
                this.vx = Math.cos(angle) * speed;
                this.vy = Math.sin(angle) * speed;
                this.size = 3 + Math.random() * 5;
                this.alpha = 1;
                this.color = Math.random() > 0.4 ? color : pick(palette);
                this.gravity = 0.08;
                this.decay = 0.015 + Math.random() * 0.02;
                this.shape = Math.floor(Math.random() * 3);
            }
            update() {
                this.x += this.vx; this.y += this.vy;
                this.vy += this.gravity;
                this.alpha -= this.decay;
            }
            draw() {
                gCtx.save();
                gCtx.globalAlpha = Math.max(0, this.alpha);
                gCtx.fillStyle = this.color;
                if (this.shape === 0) {
                    gCtx.fillRect(this.x - this.size / 2, this.y - this.size / 2, this.size, this.size);
                } else if (this.shape === 1) {
                    gCtx.beginPath();
                    gCtx.arc(this.x, this.y, this.size / 2, 0, Math.PI * 2);
                    gCtx.fill();
                } else {
                    gCtx.beginPath();
                    gCtx.moveTo(this.x, this.y - this.size / 2);
                    gCtx.lineTo(this.x + this.size / 2, this.y + this.size / 2);
                    gCtx.lineTo(this.x - this.size / 2, this.y + this.size / 2);
                    gCtx.closePath();
                    gCtx.fill();
                }
                gCtx.restore();
            }
        }

        function popBalloon(balloon, px, py) {
            balloon.alive = false;
            score++;

            // Combo system
            const now = Date.now();
            if (now - lastPopTime < 600) { combo++; } else { combo = 1; }
            lastPopTime = now;

            // Particles
            for (let i = 0; i < 18; i++) {
                popParticles.push(new PopParticle(balloon.x, balloon.y, balloon.color.body));
            }

            // Combo text
            if (combo >= 2) showCombo(balloon.x, balloon.y, combo);

            // Sound
            playPopSound(combo);

            // Update UI
            updateScoreUI();

            // Increase difficulty
            difficulty = 1 + score * 0.08;

            // Win condition
            if (score >= GOAL && !gameWon) {
                gameWon = true;
                setTimeout(endGame, 600);
            }
        }

        function showCombo(x, y, c) {
            const el = document.createElement('div');
            el.className = 'combo-text';
            const colors = ['#feca57', '#48dbfb', '#ff6b6b', '#ff9ff3', '#2ed573'];
            el.style.color = pick(colors);
            el.style.left = Math.max(30, Math.min(x - 30, window.innerWidth - 100)) + 'px';
            el.style.top = (y - 20) + 'px';
            el.style.fontSize = (1.5 + Math.min(c * 0.3, 2)) + 'rem';
            if (c >= 5) {
                el.textContent = `üî• ${c}x COMBO!`;
            } else {
                el.textContent = `${c}x Combo!`;
            }
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 900);
        }

        function updateScoreUI() {
            document.getElementById('scoreLabel').textContent = `${Math.min(score, GOAL)} / ${GOAL}`;
            document.getElementById('progressFill').style.width = `${Math.min(score / GOAL * 100, 100)}%`;
        }

        function spawnBalloon() {
            if (!gameRunning || gameWon) return;
            balloons.push(new Balloon());
        }

        function gameLoop() {
            if (!gameRunning) return;
            gCtx.clearRect(0, 0, gCanvas.width, gCanvas.height);

            // Spawn
            spawnTimer++;
            const interval = Math.max(15, 40 - difficulty * 2);
            if (spawnTimer >= interval) {
                spawnBalloon();
                if (Math.random() > 0.6) spawnBalloon(); // double spawn sometimes
                spawnTimer = 0;
            }

            // Update & draw balloons
            balloons = balloons.filter(b => {
                if (!b.alive) return false;
                b.update();
                b.draw();
                return b.alive;
            });

            // Pop particles
            popParticles = popParticles.filter(p => {
                if (p.alpha <= 0) return false;
                p.update();
                p.draw();
                return true;
            });

            requestAnimationFrame(gameLoop);
        }

        // Input handlers for game
        function handleGameInput(x, y) {
            if (!gameRunning || gameWon) return;
            // Check balloons in reverse (top-most first)
            for (let i = balloons.length - 1; i >= 0; i--) {
                if (balloons[i].contains(x, y)) {
                    popBalloon(balloons[i], x, y);
                    break;
                }
            }
        }

        gCanvas.addEventListener('click', e => {
            handleGameInput(e.clientX, e.clientY);
        });
        gCanvas.addEventListener('touchstart', e => {
            e.preventDefault();
            for (const t of e.changedTouches) {
                handleGameInput(t.clientX, t.clientY);
            }
        }, { passive: false });

        // ============================================
        // CELEBRATION (reused from previous)
        // ============================================
        let fireworks = [], fwParticles = [], confetti = [], sparkles = [];
        let showRunning = false;
        let mouseX = -100, mouseY = -100;

        class Firework {
            constructor(sx, sy, tx, ty) {
                this.x = sx; this.y = sy; this.tx = tx; this.ty = ty;
                this.distTotal = Math.hypot(tx - sx, ty - sy); this.distTraveled = 0;
                this.angle = Math.atan2(ty - sy, tx - sx); this.speed = 4 + Math.random() * 3;
                this.trail = []; this.alive = true; this.color = pick(palette);
            }
            update() {
                this.trail.push({ x: this.x, y: this.y });
                if (this.trail.length > 8) this.trail.shift();
                this.x += Math.cos(this.angle) * this.speed; this.y += Math.sin(this.angle) * this.speed;
                this.distTraveled += this.speed;
                if (this.distTraveled >= this.distTotal) { this.alive = false; this.explode(); }
            }
            explode() {
                const count = 60 + Math.floor(Math.random() * 40);
                for (let i = 0; i < count; i++) {
                    const a = (Math.PI * 2 / count) * i + Math.random() * 0.3, s = 1 + Math.random() * 5;
                    fwParticles.push({ x: this.x, y: this.y, vx: Math.cos(a) * s, vy: Math.sin(a) * s, alpha: 1, color: Math.random() > 0.3 ? this.color : pick(palette), size: 1.5 + Math.random() * 2, decay: 0.012 + Math.random() * 0.015, gravity: 0.03 });
                }
                playBoomSound();
            }
            draw() {
                fwCtx.beginPath(); fwCtx.arc(this.x, this.y, 2.5, 0, Math.PI * 2); fwCtx.fillStyle = this.color; fwCtx.fill();
                this.trail.forEach((p, i) => { fwCtx.beginPath(); fwCtx.arc(p.x, p.y, 1.5 * (i / this.trail.length), 0, Math.PI * 2); fwCtx.fillStyle = this.color; fwCtx.globalAlpha = i / this.trail.length * 0.5; fwCtx.fill(); fwCtx.globalAlpha = 1; });
            }
        }

        function launchFirework() {
            const w = fwCanvas.width, h = fwCanvas.height;
            fireworks.push(new Firework(w * (0.2 + Math.random() * 0.6), h, w * (0.1 + Math.random() * 0.8), h * (0.1 + Math.random() * 0.35)));
        }

        class ConfettiPiece {
            constructor(burst) {
                this.x = burst ? (cfCanvas.width * Math.random()) : (Math.random() * cfCanvas.width);
                this.y = burst ? (cfCanvas.height * 0.3 * Math.random()) : (Math.random() * -cfCanvas.height * 0.5);
                this.size = 4 + Math.random() * 8; this.vy = 1 + Math.random() * 2.5; this.vx = Math.random() * 2 - 1;
                this.rot = Math.random() * 360; this.rotV = (Math.random() - 0.5) * 8;
                this.color = pick(palette); this.shape = Math.floor(Math.random() * 4);
                this.wobble = Math.random() * Math.PI * 2; this.wobbleSpeed = 0.03 + Math.random() * 0.04;
                this.opacity = 0.7 + Math.random() * 0.3;
            }
            update() {
                this.y += this.vy; this.x += this.vx + Math.sin(this.wobble) * 0.8;
                this.rot += this.rotV; this.wobble += this.wobbleSpeed;
                if (this.y > cfCanvas.height + 30) { this.y = -20; this.x = Math.random() * cfCanvas.width; }
            }
            draw() {
                cfCtx.save(); cfCtx.translate(this.x, this.y); cfCtx.rotate(this.rot * Math.PI / 180);
                cfCtx.globalAlpha = this.opacity; cfCtx.fillStyle = this.color;
                if (this.shape === 0) cfCtx.fillRect(-this.size / 2, -this.size / 4, this.size, this.size / 2);
                else if (this.shape === 1) { cfCtx.beginPath(); cfCtx.arc(0, 0, this.size / 2, 0, Math.PI * 2); cfCtx.fill(); }
                else if (this.shape === 2) { cfCtx.beginPath(); cfCtx.moveTo(0, -this.size / 2); cfCtx.lineTo(this.size / 2, this.size / 2); cfCtx.lineTo(-this.size / 2, this.size / 2); cfCtx.closePath(); cfCtx.fill(); }
                else { const s = this.size / 2; cfCtx.beginPath(); for (let i = 0; i < 5; i++) { const a = (Math.PI * 2 / 5) * i - Math.PI / 2, r = i % 2 === 0 ? s : s * 0.4; cfCtx.lineTo(Math.cos(a) * r, Math.sin(a) * r); } cfCtx.closePath(); cfCtx.fill(); }
                cfCtx.restore();
            }
        }

        function addSparkle(x, y) {
            for (let i = 0; i < 3; i++) sparkles.push({ x: x + (Math.random() - 0.5) * 20, y: y + (Math.random() - 0.5) * 20, size: 2 + Math.random() * 4, alpha: 1, decay: 0.02 + Math.random() * 0.03, color: pick(palette), vx: (Math.random() - 0.5) * 2, vy: (Math.random() - 0.5) * 2 - 1 });
        }
        document.addEventListener('mousemove', e => { if (showRunning) { mouseX = e.clientX; mouseY = e.clientY; } });
        document.addEventListener('touchmove', e => { if (showRunning && e.touches[0]) { mouseX = e.touches[0].clientX; mouseY = e.touches[0].clientY; } }, { passive: true });

        function celebrationLoop() {
            if (!showRunning) return;
            fwCtx.globalCompositeOperation = 'destination-out'; fwCtx.fillStyle = 'rgba(0,0,0,0.15)'; fwCtx.fillRect(0, 0, fwCanvas.width, fwCanvas.height); fwCtx.globalCompositeOperation = 'lighter';
            fireworks = fireworks.filter(f => { f.update(); f.draw(); return f.alive; });
            fwParticles = fwParticles.filter(p => { p.x += p.vx; p.y += p.vy; p.vy += p.gravity; p.alpha -= p.decay; if (p.alpha <= 0) return false; fwCtx.beginPath(); fwCtx.arc(p.x, p.y, p.size, 0, Math.PI * 2); fwCtx.fillStyle = p.color; fwCtx.globalAlpha = p.alpha; fwCtx.fill(); fwCtx.globalAlpha = 1; return true; });
            cfCtx.clearRect(0, 0, cfCanvas.width, cfCanvas.height); confetti.forEach(c => { c.update(); c.draw(); });
            spCtx.clearRect(0, 0, spCanvas.width, spCanvas.height);
            if (mouseX > 0 && mouseY > 0) addSparkle(mouseX, mouseY);
            sparkles = sparkles.filter(s => { s.x += s.vx; s.y += s.vy; s.alpha -= s.decay; if (s.alpha <= 0) return false; spCtx.save(); spCtx.globalAlpha = s.alpha; spCtx.fillStyle = s.color; spCtx.shadowColor = s.color; spCtx.shadowBlur = 10; spCtx.beginPath(); spCtx.arc(s.x, s.y, s.size * 0.4, 0, Math.PI * 2); spCtx.fill(); spCtx.restore(); return true; });
            requestAnimationFrame(celebrationLoop);
        }

        let fwInterval, balloonFloatInterval;
        const floatEmojis = ['üéà', 'üéà', 'ü©∑', 'üíú', 'üíõ', 'üíô', 'üß°', '‚ù§Ô∏è'];

        function spawnFloatBalloon() {
            const c = document.getElementById('balloonContainer'), b = document.createElement('div');
            b.classList.add('float-balloon'); b.textContent = pick(floatEmojis);
            b.style.left = Math.random() * 100 + '%'; b.style.animationDuration = (8 + Math.random() * 8) + 's';
            b.style.fontSize = (2 + Math.random() * 2.5) + 'rem';
            c.appendChild(b); setTimeout(() => b.remove(), 18000);
        }

        function endGame() {
            gameRunning = false;
            gCanvas.style.pointerEvents = 'none';
            gCtx.clearRect(0, 0, gCanvas.width, gCanvas.height);
            document.getElementById('gameUI').style.opacity = '0';

            // Flash!
            const flash = document.getElementById('screenFlash');
            flash.classList.add('flash');
            setTimeout(() => flash.classList.remove('flash'), 200);

            // Start celebration
            const n = window.innerWidth < 600 ? 100 : 200;
            confetti = []; for (let i = 0; i < n; i++)confetti.push(new ConfettiPiece(false));
            showRunning = true; celebrationLoop();
            setTimeout(() => document.getElementById('mainContent').classList.add('visible'), 300);
            document.getElementById('lightRays').classList.add('active');

            let fwCount = 0;
            fwInterval = setInterval(() => { launchFirework(); if (Math.random() > 0.5) launchFirework(); fwCount++; if (fwCount > 40) { clearInterval(fwInterval); fwInterval = setInterval(() => { if (Math.random() > 0.4) launchFirework(); }, 2000); } }, 400);
            balloonFloatInterval = setInterval(spawnFloatBalloon, 1200);
            for (let i = 0; i < 5; i++) setTimeout(spawnFloatBalloon, i * 300);

            playBirthdayMelody();
            setTimeout(() => document.getElementById('replayBtn').classList.add('visible'), 14000);

            // Allow tapping for extra effects
            document.body.addEventListener('click', celebrationTap);
        }

        function celebrationTap(e) {
            if (!showRunning) return;
            if (e.target.closest('.sound-toggle') || e.target.closest('.replay-btn')) return;
            playPopSound(1);
            for (let i = 0; i < 20; i++) { const c = new ConfettiPiece(true); c.x = e.clientX + (Math.random() - 0.5) * 80; c.y = e.clientY + (Math.random() - 0.5) * 80; c.vy = -(Math.random() * 3 + 1); confetti.push(c); }
            fireworks.push(new Firework(e.clientX, e.clientY + 50, fwCanvas.width * (0.1 + Math.random() * 0.8), fwCanvas.height * (0.05 + Math.random() * 0.25)));
            setTimeout(() => { if (confetti.length > 400) confetti.splice(0, confetti.length - 200); }, 3000);
        }

        // ============================================
        // AUDIO
        // ============================================
        function playNote(freq, startTime, dur, type = 'triangle', vol = 0.08) {
            if (!audioCtx || !soundEnabled) return;
            const o = audioCtx.createOscillator(), g = audioCtx.createGain();
            o.type = type; o.frequency.setValueAtTime(freq, startTime);
            g.gain.setValueAtTime(0, startTime); g.gain.linearRampToValueAtTime(vol, startTime + 0.02);
            g.gain.exponentialRampToValueAtTime(0.0001, startTime + dur);
            o.connect(g); g.connect(audioCtx.destination); o.start(startTime); o.stop(startTime + dur);
        }

        function playPopSound(comboLevel = 1) {
            if (!audioCtx || !soundEnabled) return;
            const now = audioCtx.currentTime;
            // Higher pitch with combo
            const baseFreq = 600 + comboLevel * 80;
            playNote(baseFreq + Math.random() * 300, now, 0.08, 'sine', 0.06);
            // Extra sparkle on high combo
            if (comboLevel >= 3) {
                playNote(1200 + Math.random() * 400, now + 0.03, 0.1, 'sine', 0.03);
            }
            if (comboLevel >= 5) {
                playNote(1600 + Math.random() * 400, now + 0.06, 0.12, 'sine', 0.025);
            }
        }

        function playBoomSound() {
            if (!audioCtx || !soundEnabled) return;
            const now = audioCtx.currentTime;
            const bufLen = audioCtx.sampleRate * 0.3, buf = audioCtx.createBuffer(1, bufLen, audioCtx.sampleRate), data = buf.getChannelData(0);
            for (let i = 0; i < bufLen; i++) data[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / bufLen, 3);
            const src = audioCtx.createBufferSource(); src.buffer = buf;
            const gain = audioCtx.createGain(); gain.gain.setValueAtTime(0.06, now); gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.3);
            const filter = audioCtx.createBiquadFilter(); filter.type = 'lowpass'; filter.frequency.setValueAtTime(800, now);
            src.connect(filter); filter.connect(gain); gain.connect(audioCtx.destination); src.start(now);
            playNote(1200 + Math.random() * 800, now + 0.05, 0.2, 'sine', 0.03);
        }

        function playBirthdayMelody() {
            if (!audioCtx || !soundEnabled) return;
            const now = audioCtx.currentTime;
            const notes = [{ f: 262, t: 0, d: 0.3 }, { f: 262, t: 0.35, d: 0.15 }, { f: 294, t: 0.55, d: 0.5 }, { f: 262, t: 1.1, d: 0.5 }, { f: 349, t: 1.65, d: 0.5 }, { f: 330, t: 2.2, d: 0.9 }, { f: 262, t: 3.3, d: 0.3 }, { f: 262, t: 3.65, d: 0.15 }, { f: 294, t: 3.85, d: 0.5 }, { f: 262, t: 4.4, d: 0.5 }, { f: 392, t: 4.95, d: 0.5 }, { f: 349, t: 5.5, d: 0.9 }, { f: 262, t: 6.6, d: 0.3 }, { f: 262, t: 6.95, d: 0.15 }, { f: 523, t: 7.15, d: 0.5 }, { f: 440, t: 7.7, d: 0.5 }, { f: 349, t: 8.25, d: 0.4 }, { f: 330, t: 8.7, d: 0.4 }, { f: 294, t: 9.15, d: 0.7 }, { f: 466, t: 10.1, d: 0.3 }, { f: 466, t: 10.45, d: 0.15 }, { f: 440, t: 10.65, d: 0.5 }, { f: 349, t: 11.2, d: 0.5 }, { f: 392, t: 11.75, d: 0.5 }, { f: 349, t: 12.3, d: 1.0 }];
            notes.forEach(n => { playNote(n.f, now + n.t, n.d, 'triangle', 0.09); playNote(n.f * 2, now + n.t, n.d * 0.5, 'sine', 0.025); });
            setTimeout(() => { if (!soundEnabled || !audioCtx) return; const t = audioCtx.currentTime;[523, 659, 784, 1047].forEach((f, i) => playNote(f, t + i * 0.12, 0.9, 'sine', 0.06)); }, 13500);
        }

        function playGameStartSound() {
            if (!audioCtx || !soundEnabled) return;
            const now = audioCtx.currentTime;
            [392, 523, 659, 784].forEach((f, i) => playNote(f, now + i * 0.1, 0.2, 'triangle', 0.07));
        }

        // ============================================
        // START / RESTART
        // ============================================
        function startGame() {
            // Reset
            balloons = []; popParticles = []; score = 0; combo = 0;
            gameWon = false; difficulty = 1; spawnTimer = 0;
            lastPopTime = 0;
            updateScoreUI();

            // Show game elements
            gCanvas.style.pointerEvents = 'auto';
            document.getElementById('gameUI').style.opacity = '1';

            // Hide celebration
            showRunning = false;
            clearInterval(fwInterval); clearInterval(balloonFloatInterval);
            fireworks = []; fwParticles = []; confetti = []; sparkles = [];
            fwCtx.clearRect(0, 0, fwCanvas.width, fwCanvas.height);
            cfCtx.clearRect(0, 0, cfCanvas.width, cfCanvas.height);
            spCtx.clearRect(0, 0, spCanvas.width, spCanvas.height);
            document.getElementById('balloonContainer').innerHTML = '';
            document.getElementById('lightRays').classList.remove('active');
            document.getElementById('mainContent').classList.remove('visible');
            document.getElementById('replayBtn').classList.remove('visible');
            document.body.removeEventListener('click', celebrationTap);

            gameRunning = true;
            playGameStartSound();
            gameLoop();
        }

        // Intro screen
        document.getElementById('startGameBtn').addEventListener('click', e => {
            e.stopPropagation();
            initAudio();
            document.getElementById('introScreen').classList.add('hidden');
            setTimeout(startGame, 400);
        });
        document.getElementById('introScreen').addEventListener('touchend', e => {
            if (e.target.id === 'startGameBtn' || e.target.closest('#startGameBtn')) {
                e.preventDefault();
                initAudio();
                document.getElementById('introScreen').classList.add('hidden');
                setTimeout(startGame, 400);
            }
        });

        // Sound toggle
        document.getElementById('soundToggle').addEventListener('click', e => {
            e.stopPropagation();
            soundEnabled = !soundEnabled;
            e.currentTarget.textContent = soundEnabled ? 'üîä' : 'üîá';
        });

        // Replay ‚Äî goes back to game
        document.getElementById('replayBtn').addEventListener('click', e => {
            e.stopPropagation();
            startGame();
        });
    </script>
</body>

</html>